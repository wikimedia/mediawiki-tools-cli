image-update-build:
    stage: build
    cache: {}
    image:
      name: golang:1.18
      pull_policy: if-not-present
    script:
       - go run ./tools/image-update/check/check.go
       - cp .gitlab/weekly.image-update.yml .gitlab/weekly.image-update.generated.yml
       - |+
         if [ ! -f "./tools/image-update/.update.sh" ]; then
           echo "        - COMMAND: echo null" >> .gitlab/weekly.image-update.generated.yml
           echo "No update commands to run"
           exit 0
         fi
       - echo "Update commands collected..."
       - cat ./tools/image-update/.update.sh
       - |+
         while read line; do
           line=$(echo $line|tr -d '\n')
           echo "        - COMMAND: ${line}" >> .gitlab/weekly.image-update.generated.yml
         done < ./tools/image-update/.update.sh
       - cat .gitlab/weekly.image-update.generated.yml
    artifacts:
        paths:
          - .gitlab/weekly.image-update.generated.yml

image-update-trigger:
  stage: build
  needs:
    - image-update-build
  trigger:
    include:
      - artifact: .gitlab/weekly.image-update.generated.yml
        job: image-update-build
    strategy: depend
